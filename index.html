<!DOCTYPE html>
<html>

<head>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css" />
</head>

<body>
  <section class="hero is-primary is-bold">
    <div class="hero-body">
      <div class="container">
        <h1 class="title">ECE286 Survey</h1>
      </div>
    </div>
  </section>

  <form id="form" class="container m-4 pl-4" method="POST">

    <!-- Name -->
    <div class="field part1">
      <label class="label">Name</label>
      <div class="control">
        <input class="input" type="text" placeholder="Your Full Name" name="Name" />
      </div>
    </div>

    <!-- Email -->
    <div class="field part1">
      <label class="label">Email</label>
      <div class="control">
        <input class="input" type="email" placeholder="Your Email" name="Email" />
      </div>
    </div>

    <!-- University -->
    <div class="field part1">
      <label class="label">University</label>
      <div class="control">
        <div class="select">
          <select>
            <option name="University" value="University of Toronto">University of Toronto</option>
            <option name="University" value="University of Waterloo">University of Waterloo</option>
            <option name="University" value="Other">Other</option>
          </select>
        </div>
      </div>
    </div>

    <!-- Year of Study -->
    <div class="field part1">
      <label class="label">Year of Study</label>
      <div class="control">
        <label class="radio">
          <input type="radio" name="Year" value="1" /> 1
        </label>
        <label class="radio">
          <input type="radio" name="Year" value="2" /> 2
        </label>
        <label class="radio">
          <input type="radio" name="Year" value="3" /> 3
        </label>
        <label class="radio">
          <input type="radio" name="Year" value="4" /> 4
        </label>
        <label class="radio">
          <input type="radio" name="Year" value="Other" /> Other
        </label>
      </div>
    </div>

    <!-- Consent -->
    <div class="field part1">

      <div class="control">
        <label class="checkbox">
          <input type="checkbox" name="Consent" />
          I agree to participate in this study.
        </label>
      </div>
      <p id="consent-message" class="help is-danger" style="display: none;">Please agree to participate in this study.</p>
    </div>



    <!-- First Next Button -->
    <div class="field part1">
      <div class="control">
        <button class="button is-primary" type="button" id="next1">
          Next
        </button>
      </div>
    </div>

    <!-- Submit Button -->
    <div class="field part3" style="display: none;">
      <div class="control">
        <button class="button is-primary" type="submit" id="submit-button">
          Submit
        </button>
      </div>
    </div>

    <!-- Submission Message -->
    <div id="message" class="message" style="display: none;">
      <div class="message-body"></div>
    </div>

  </form>


  <script>
    // First Next Button
    document.getElementById("next1").addEventListener("click", function () {

      //check checkbox
      if (!document.getElementsByName("Consent")[0].checked) {
        document.getElementById("consent-message").style.display = "block";
        return;
      }

      Array.from(document.getElementsByClassName("part1")).forEach(function (element) {
        element.style.display = "none";
      });

      Array.from(document.getElementsByClassName("part2")).forEach(function (element) {
        element.style.display = "block";
      });
    });



    // Submit Button
    document.getElementById("form").addEventListener("submit", function (e) {

      // Prevent the default form submission
      e.preventDefault();

      // Update Display Message
      var messageDiv = document.getElementById("message");
      var messageBody = messageDiv.querySelector(".message-body");
      messageDiv.classList.add("is-warning");
      messageBody.textContent = "Submitting..";
      messageDiv.style.display = "block";
      document.getElementById("submit-button").disabled = true;

      // Collect the form data
      var formData = new FormData(this);
      var keyValuePairs = [];
      for (var pair of formData.entries()) {
        keyValuePairs.push(pair[0] + "=" + pair[1]);
      }
      var formDataString = keyValuePairs.join("&");
      console.log(formDataString);

      // Send a POST request to your Google Apps Script
      fetch(
        "https://script.google.com/macros/s/AKfycbwoUTKYNR82YRn_Eec_78M2M3g1rV-Cjc3zpmKYYEnBYxt7X13r9suEVzLcRpLgKGd7Qw/exec",
        {
          redirect: "follow",
          method: "POST",
          body: formDataString,
          headers: {
            "Content-Type": "text/plain;charset=utf-8",
          },
        }
      ).then(function (response) {

        // Check if the request was successful
        if (response.ok) {
          return response;
        } else {
          throw new Error("Failed to submit the form.");
        }

      }).then(function (data) {

        // Display a success message
        messageBody.textContent = "Data submitted successfully! Thank you for your response.";
        messageDiv.classList.remove("is-warning");
        messageDiv.classList.add("is-success");
        document.getElementById("submit-button").disabled = false;
        document.getElementById("form").reset();

        // Hide the message after a few seconds
        setTimeout(function () {
          messageBody.textContent = "";
          messageDiv.classList.remove("is-success");
          messageDiv.classList.remove("is-warning");
          messageDiv.style.display = "none";
        }, 2600);

      }).catch(function (error) {

        // Handle errors
        console.error(error);
        messageBody.textContent = "An error occurred while submitting the form.";
        messageDiv.classList.remove("is-warning");
        messageDiv.classList.add("is-danger");
        document.getElementById("submit-button").disabled = false;

      });
    });
  </script>
</body>

</html>